- Triple ECC header redundancy
  1. Refactor header handling (no behavior change).
      - Add an EccHeader struct that owns the current fields (magic, version, flags, block sizes, counts).
      - Give it helpers like bool serialize(u8* dest), bool write(BitWriter&), and static bool parse(const u8* bytes, usize len, EccHeader&).
      - Replace the ad hoc pointer math in encode_payload_with_ecc, build_ecc_header_bytes, and parse_ecc_header with the struct.
      - Run the existing round-trip tests to confirm no regressions.
  2. Store multiple raw header copies.
      - Teach encode_payload_with_ecc to emit the canonical header plus two identical byte copies immediately afterward (still unprotected).
      - Adjust makocode::ECC_HEADER_BYTES (or add a new constant) so shuffle/unshuffle, bit-length accounting, and decoder skipping logic know the new total header span.
      - Update build_frame_bits/decoder to consume all three copies before touching payload bits.
      - Verify the suite still passes; behavior is unchanged except for the extra bytes.
  3. Protect each copy with Reed–Solomon.
      - Define a tiny RS configuration (e.g., data=26 bytes, parity=6 bytes) reused for all copies.
      - During encode, wrap each header clone in a parity block (header data + RS parity) and emit that as the “copy.”
      - On decode, run the matching RS decode for each copy; accept the first successful decode or majority-vote between successes. If all fail, fall back to metadata
        reconstruction.
      - Add counters/logging so you can see when a copy needed repair. Re-run targeted blot tests.
  4. Propagate awareness everywhere.
      - Ensure shuffle/unshuffle skip the entire protected header region.
      - Update metadata repair (build_ecc_header_bytes) and debug dumps to write/read all copies.
      - Make the decoder’s “header repaired from metadata” path re-encode all three RS-protected copies, not just the first.
      - Confirm commands like --ecc-fill and multi-page encode/decode still work.
  5. Test corruption tolerance.
      - Extend or add a scripted test that deliberately corrupts one and two header copies (e.g., use dd or a helper to flip bytes) before running makocode decode.
      - Validate that with one busted copy decode still passes, with two busted copies the third copy (or metadata) carries you, and with all three broken you still fail
        cleanly.
      - Run scripts/run_test_suite.sh to ensure the whole regression suite stays green.

- Features
 - Confirm overlay avoids header or sensitive data
 - Overlay needs explicit palette arg, threshold the overlay image first.
 - Overay needs --ignore-color arg
 - Overlay won't work well on final page
 - Color channels non-base-2, works but slow
 - 15 column ppm (from convert) in overlay, ignore newlines

- Decoding
 - Fix all commented out tests in scripts/run_test_suite.sh
 - Remove entire page test, with high ECC
 - Remove all headers from encoding, one by one and fix decoding for each one.
  - # MAKOCODE_BITS
  - # MAKOCODE_PAGE_BITS
  - # MAKOCODE_PAGE_WIDTH_PX
  - # MAKOCODE_PAGE_HEIGHT_PX
  - # MAKOCODE_ECC
  - # MAKOCODE_ECC_BLOCK_DATA
  - # MAKOCODE_ECC_PARITY
  - # MAKOCODE_ECC_BLOCK_COUNT
  - # MAKOCODE_ECC_ORIGINAL_BYTES
  - # MAKOCODE_COLOR_CHANNELS
   - Detect colors automatically in decoding, optionally write out color channel information in footer
  - # MAKOCODE_PAGE_COUNT
  - # MAKOCODE_PAGE_INDEX
   - Document user can provide blank pages for their gaps. Argument could be supplied for which pages are missing. Makocode could also encode page number on each page - or else guess/try missing pages.
  - # MAKOCODE_FOOTER_ROWS
  - # MAKOCODE_FONT_SIZE
  - # MAKOCODE_FIDUCIAL_SIZE
  - # MAKOCODE_FIDUCIAL_COLUMNS
  - # MAKOCODE_FIDUCIAL_ROWS
  - # MAKOCODE_FIDUCIAL_MARGIN
  - # MAKOCODE_SUBGRID_COL_OFFSETS
  - # MAKOCODE_SUBGRID_ROW_OFFSETS
 - Wavy distortion test
 - All distortions test (scale 2.5x, border/dirt, stretch, wavy) in one large image per color
 - Discolored paper (off-white) test
 - One last ask to surmise any way to improve detection of a scanned image, use optar/paperbak as reference
 - Encode ECC header or any basic data in footer in larger dots in first/last color (2-3x the regular dots). This makes it localized but less sensitive to certain kinds of damage. Footer could be optional if normal dots are kepts, it could be a backup. Or remove regular header and make footer mandatory.
 - Print calibration page, has mutliple settings, possibly binary search - scanned back in and the best settings are printed to the user. Data is randomly generated seed-0.

- Finalize
 - Mode for no filesystem, and no includes e.g. stdin/stdout data. Use preprocessor directive around all includes: #if INCLUDES \n #include ... \n #endif . Mention in docs as part of futureproofing / self-contained solution.
 - Run physical tests, check different printer/scanner/computer combinations and paper/film mediums. Leave data for a while, artificially age, folder paper, different storage conditions, etc. Post findings.
 - Determine proper defaults
 - Attempt to optimize/shrink/minify/dedupe/fix-warnings/remove-unused/constants-everywhere code, it still should be readable
 - Dependencies section (C++, G++, Shell/Linux, Python for testing)
 - Much better documentation, or a spec
 - Suggestions and specs for archival file formats (Text: txt, images: PPM, Video: YUV4MPEG2)
 - Full test coverage, remove python dependency (scripts/ppm_transform.py)
