- Features
 - Color channels non-base-2, works but slow
  - Execution Plan
    1. Design Streaming Converter
        - Re-read bits_to_base_digits / base_digits_to_bits to catalog every assumption about padding, digit order, and metadata (MAKOCODE_PAGE_SYMBOLS, MAKOCODE_PAGE_BITS).
        - Choose accumulator width (likely __uint128_t) and define helper routines (push_bits, emit_digit, emit_byte) so encode/decode share identical semantics.
        - Prove the accumulator never overflows for the largest supported palette; document constraints inline.
    2. Implement Encode-Side Streaming Path
        - In bits_to_base_digits, keep the power-of-two branch unchanged.
        - Replace the arbitrary-base fallback with a single-pass converter that walks page_bits_chunk once, fills the accumulator, and emits digits via acc % base.
        - Ensure digit padding matches compute_min_symbols_for_bits so downstream layout logic sees the same symbol counts.
    3. Implement Decode-Side Streaming Path
        - Mirror the streaming logic inside base_digits_to_bits, again preserving the power-of-two fast path.
        - Consume digits once, emitting bytes whenever the accumulator has ≥8 bits; mask the last byte to the requested bit count.
        - Add sanity checks to catch base mismatches or unexpected leftover digits early.
    4. Extend Tests & Benchmarks
        - Add focused round-trip tests (e.g., new script invocations or test harness cases) that cover awkward bases like 3 and 5 at multiple payload sizes.
        - Capture before/after timing notes for at least one test (e.g., run_roundtrip.sh --label 3009), checking that runtime now scales linearly.
    5. Validate Continuously
        - After each major code change (steps 2 and 3), build and run ./makocode test --summary plus targeted round-trip scripts to ensure we haven’t broken power-of-two palettes.
        - When implementation and new tests are in place, run make test (which triggers the full suite of scripted round trips) and iterate until everything passes cleanly.
    6. Wrap Up
        - Summarize the code changes, cite timing improvements, list the tests run (with dates), and note any remaining follow-up ideas (e.g., future micro-optimizations or broader
          palette stress tests).
    This sequence keeps the suite green after every significant change while driving the encode/decode converters toward linear-time behavior.
 - Overlay needs explicit palette arg, threshold the overlay image first.
 - Handle 15 column ppm (from convert) in decode or overlay, ignore newlines
 - Use LZMA rather than LZW compression
 - Imperfect decoding, return whatever we have after ECC applies even if it's lossy
 - Need option for ECC to fill up through last page
 - Overay needs --ignore-color arg
 - Overlay won't work well on final page

- Decoding
 - Remove all headers from encoding, one by one and fix decoding for each one.
 - Or encode header in image header in large dots? Or footer
  - # MAKOCODE_BITS
  - # MAKOCODE_PAGE_BITS
  - # MAKOCODE_PAGE_WIDTH_PX
  - # MAKOCODE_PAGE_HEIGHT_PX
  - # MAKOCODE_ECC
  - # MAKOCODE_ECC_BLOCK_DATA
  - # MAKOCODE_ECC_PARITY
  - # MAKOCODE_ECC_BLOCK_COUNT
  - # MAKOCODE_ECC_ORIGINAL_BYTES
  - # MAKOCODE_COLOR_CHANNELS
   - Detect colors automatically in decoding, optionally write out color channel information in footer
  - # MAKOCODE_PAGE_COUNT
  - # MAKOCODE_PAGE_INDEX
   - Document user can provide blank pages for their gaps. Argument could be supplied for which pages are missing. Makocode could also encode page number on each page - or else guess/try missing pages.
  - # MAKOCODE_FOOTER_ROWS
  - # MAKOCODE_FONT_SIZE
  - # MAKOCODE_FIDUCIAL_SIZE
  - # MAKOCODE_FIDUCIAL_COLUMNS
  - # MAKOCODE_FIDUCIAL_ROWS
  - # MAKOCODE_FIDUCIAL_MARGIN
  - # MAKOCODE_SUBGRID_COL_OFFSETS
  - # MAKOCODE_SUBGRID_ROW_OFFSETS
 - Fix wavy distortion test
 - All distortions test (scale 2.5x, border/dirt, stretch, wavy) in one large image per color
 - Coffee stain test, black marker test, page folded/cut test
 - One last ask to surmise any way to improve detection of a scanned image, use optar/paperbak as reference
 - Remove entire page test, with high ECC
 - Print calibration page, has mutliple settings, possibly binary search - scanned back in and the best settings are printed to the user. Data is randomly generated seed-0.

- Finalize
 - Run physical tests, check different printer/scanner/computer combinations and paper/film mediums. Leave data for a while, artificially age, different storage conditions, etc. Post findings.
 - Determine proper defaults
 - Attempt to optimize/shrink/minify/dedupe code, it still should be readable
 - Full test coverage, move out of makocode.cpp?
